---
id: version-2.2.0-ble_magnetic_sensor
title: 磁気センサー
sidebar_label: 🔄 磁気センサー
original_id: ble_magnetic_sensor
---

キューブは磁気センサーによってキューブの天面に装着された磁石の種類（定義済みのレイアウトパターン）を検出できます。磁石のハードウェア仕様については[ハードウェア仕様 - 磁気センサー](hardware_magnet.md)を参照してください。

> この機能は**デフォルトでは無効**になっています。[設定 - 磁気センサー機能の設定](configuration.md#磁気センサー機能の設定)で有効化することではじめて利用可能になります。

磁気センサーの情報は以下の特性（characteristic）を使うことで取得できます。特性は[モーションセンサー](sensor.md)と同じです。

| プロパティ          | 値                                                                                 |
| ------------------- | ---------------------------------------------------------------------------------- |
| Characteristic UUID | 10B20106-5B3B-4571-9508-CF3EFCD7BBAE                                               |
| Properties          | [Write](#書き込み操作), [Read](#読み出し操作--通知), [Notify](#読み出し操作--通知) |
| Descriptor          | Sensor Information                                                                 |

## **書き込み操作**

### 磁気センサー情報の要求

以下のデータを書き込むことで磁気センサー情報を要求できます。キューブは要求を受け取ると、必ず 1 回磁気センサー情報の通知を行います。

| データ位置 | タイプ | 内容       | 例                                                  |
| ---------- | ------ | ---------- | --------------------------------------------------- |
| 0          | UInt8  | 情報の種類 | <span fixed>`0x82`</span> (磁気センサー情報の要求） |

## **読み出し操作 / 通知**

キューブの磁気センサーの情報が変化すると、この特性は BLE セントラルに情報を通知します。
通知される情報は読み出し操作でも取得できます。

> 特性は[モーションセンサー](sensor.md)と共通です。モーションセンサーの情報も取得されますので、利用の際には[モーションセンサー - 読み出し操作 / 通知](sensor.md#読み出し操作--通知)も確認してください。

### 磁気センサー情報の取得

| データ位置 | タイプ | 内容       | 例                                            |
| ---------- | ------ | ---------- | --------------------------------------------- |
| 0          | UInt8  | 情報の種類 | <span fixed>`0x02`</span>（磁気センサー情報） |
| 1          | UInt8  | 磁石の状態 | `0x00`（未装着）                              |

#### 磁石の状態

キューブの天面に装着された磁石の状態（未装着もしくは定義済みのレイアウトパターン）の ID です。未装着時は`0x00`になり、装着時は`0x01`から`0x06`の 6 つのパターンのいずれかになります。レイアウトパターンの仕様については[ハードウェア仕様 - 磁気センサー](hardware_magnet.md)を参照してください。

未装着もしくは[ハードウェア仕様 - 磁気センサー](hardware_magnet.md)で定義されている 6 つのパターン、合わせて 7 つのパターン以外の磁力を検出した場合は情報を更新しません。
